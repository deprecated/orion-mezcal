<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Orion S</title>
<!-- 2013-10-21 Mon 11:25 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="William Henney" />
<style type="text/css">
<!--/*--><![CDATA[/*><!--*/
html {
    font-family: Lucida Grande, Tahoma, Arial, Helvetica, sans-serif;
    font-size: 11pt;
    /* color:  rgb(224, 224, 224); */
    /* background: rgb(48, 48, 48); */
}

/* Links */
a:link {color: #333399; }
a:visited {color: #777788; }
a:hover {color: #2222ff; }


/* Added by Will 03 Sep 2007 */
li {padding: 4px; }

/* Added by Will 08 Oct 2007 */ 

/* Headings shamelessly copied from MoinMoin theme "sinorca4moin" by David Linke*/

h1, h2, h3, h4, h5 {
	margin: 1em 0 0.5em 0;
	padding: 0.5em 0.5em 0.5em 0.5em;
        font-weight: bold;
	/* background-color: #fafada; */
	line-height: 1.2em;
}	

/* h5, h6 { */
/*     border-bottom: 1px dashed rgb(135,135,135); */
/* }   */
/* h1, h2, h3, h4 { */
/*     /\* border-left: 1px solid rgb(135,135,135); *\/ */
/*     border-bottom: 2px solid rgb(135,135,135); */
/* }   */

h1, h2, h3, h4, h5, h6 {
    color: rgb(16,16,32);
}
h1 {font-size: 140%;}
h2 {font-size: 120%;}
h3, h4, h5, h6 {font-size: 100%;}
h6 {font-style: italic;}

/* .src:before {  */
/*     background: #3F3F3F; */
/*     border-right: 1px solid #DCDCDC; border-bottom: 1px solid #DCDCDC; */
/* } */

.src {
    background: #4F4F4F;
    color: #ECECEC;
}
.example, thead {
    background: #E3E3E3;
}

pre.src:before {
    color: black;
}

pre.src {
    overflow: auto;
}

/* pre.src-python:before { content: 'Python'; } */

.wjhfig {
    background-color: #eee;
    padding: 10pt;
    margin: 10pt;
}
.figure, img {
    padding: 0pt;
    margin: 0pt;
}

/* Make sure paragraphs are no thinner than a certain width, even if
   there is a floating div eating up their space - based on this tip:
   http://css-tricks.com/minimum-paragraph-widths */ 
p:before {
  content: "";
  width: 20em;
  display: block;
  overflow: hidden;
  /* For Demonstration */
  /* border: 1px solid green; */
}

/* ul { */
/*     /\* try and fix item indentation when the list is to the right pf a */
/*        "float:left" div.  Initially inspired by advice from */
/*        http://wordpress.org/support/topic/left-float-and-bullet-lists-not-playing-well-together */
/*        although in the end I had to do things differently*\/ */
/*     list-style: inside; */
/*     text-indent: 10pt; */
/* } */
/* ul > li > ul { text-indent: 20pt; } */
/* ul > li > ul > li > ul { text-indent: 30pt; } */

.src, .example, table {
    font-size: 80%;
}

tbody {
    background-color: #fafada;
    /* background-color: rgb(250, 250, 200); */
}


#table-of-contents {
    background-color: #f0f0f0;
}




/*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Orion S</h1>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">High-level data products</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>All of these files have WCS headers with (RA, DEC) in J2000 and heliocentric velocities in km/s
<ul class="org-ul">
<li>Positions were calculated with respect to the proplyd 159-350 and have been checked against HST imaging. 
</li>
</ul>
</li>
<li>They have all had the ghost line removed and the continuum subtracted (except for <code>cont-map.fits</code>). See below for details. 
</li>
<li>There is no interpolation in declination: instead the spectra are simply stacked on the assumption that the Dec spacing is a regular 1.4 arcseconds.  In reality, the Dec spacing varies between 0.75 and 1.95 arcsec.  As a result, there is a jitter of up to 0.5 arcsec in the declinations.   However, from comparing the integrated line and continuum maps  (<code>rough-map.fits</code>  and <code>cont-map.fits</code>) with the WFPC2 mosaic this does not seem to be a serious issue.
</li>
</ul>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><code>spm-vstack-oiii.fits</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
Datacube in which each plane is the 2D [O III] line spectrum from a horizontal slit: x-axis is RA, y-axis is velocity.  Stepping through the planes (z-axis) corresponds to different declinations.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><code>rough-cube.fits</code></h3>
<div class="outline-text-3" id="text-1-2">
<p>
Datacube that has been rotated so that each plane is an isovelocity image: x-axis is RA, y-axis is Dec.  Stepping through the planes (z-axis) corresponds to different heliocentric velocities. Note that the pixels are not square, so make sure to select "Zoom-&gt;Align" in <code>ds9</code>.  Alternatively do "Frame-&gt;Match-&gt;WCS" with another image (e.g., WFPC2 mosaic). 
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><code>rough-map.fits</code></h3>
<div class="outline-text-3" id="text-1-3">
<p>
Map of the total line emission.  The integral of <code>rough-cube.fits</code> along the z-axis (velocity). 
</p>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><code>cont-map.fits</code></h3>
<div class="outline-text-3" id="text-1-4">
<p>
Map of the continuum emission that was fitted and removed from each spatial pixel.  Mainly useful for checking that the stars come out at the right positions.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">List of pointings</h2>
<div class="outline-text-2" id="text-2">
<p>
These are just the image/slits, originally copied from the tables <a href="spm-feb-2013.html#ID-C5DA60EC-52DA-433B-9534-E5FD1E958D9B">here</a> and <a href="spm-feb-2013.html#ID-C5F98384-805C-487D-A745-C6B9BE309927">here</a>
</p>

<ul class="org-ul">
<li>We go from 12 0.354 = 4.248" N to 46 0.354 = 16.284" S of 159-350, with nominal spacing of 4 0.354 = 1.416"
</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">FILENAME</th>
<th scope="col" class="right">DATE-OBS</th>
<th scope="col" class="right">UT</th>
<th scope="col" class="left">FILTER</th>
<th scope="col" class="right">GRATING</th>
<th scope="col" class="right">EXPTIME</th>
<th scope="col" class="left">APERTURE</th>
<th scope="col" class="right">CBIN</th>
<th scope="col" class="right">RBIN</th>
<th scope="col" class="right">RA</th>
<th scope="col" class="right">DEC</th>
<th scope="col" class="right">AIRMASS</th>
<th scope="col" class="left">Offset</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">spm046.fits</td>
<td class="right">2013-02-17</td>
<td class="right">03:38:58</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:52.600</td>
<td class="right">-05:24:25.00</td>
<td class="right">1.24</td>
<td class="left">N 12 pix</td>
</tr>

<tr>
<td class="left">spm050.fits</td>
<td class="right">2013-02-17</td>
<td class="right">03:59:03</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:53.000</td>
<td class="right">-05:24:26.00</td>
<td class="right">1.25</td>
<td class="left">N 8 pix</td>
</tr>

<tr>
<td class="left">spm054.fits</td>
<td class="right">2013-02-17</td>
<td class="right">04:22:49</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:53.500</td>
<td class="right">-05:24:25.00</td>
<td class="right">1.28</td>
<td class="left">N 4 pix</td>
</tr>

<tr>
<td class="left">spm059.fits</td>
<td class="right">2013-02-17</td>
<td class="right">04:44:45</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:53.900</td>
<td class="right">-05:24:27.00</td>
<td class="right">1.32</td>
<td class="left">N 0 pix</td>
</tr>

<tr>
<td class="left">spm063.fits</td>
<td class="right">2013-02-17</td>
<td class="right">05:05:40</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:54.100</td>
<td class="right">-05:24:28.00</td>
<td class="right">1.37</td>
<td class="left">S 4 pix</td>
</tr>

<tr>
<td class="left">spm067.fits</td>
<td class="right">2013-02-17</td>
<td class="right">05:25:27</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:54.400</td>
<td class="right">-05:24:27.00</td>
<td class="right">1.44</td>
<td class="left">S 8 pix</td>
</tr>

<tr>
<td class="left">spm071.fits</td>
<td class="right">2013-02-17</td>
<td class="right">05:48:53</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:54.400</td>
<td class="right">-05:24:25.00</td>
<td class="right">1.54</td>
<td class="left">S 12 pix</td>
</tr>

<tr>
<td class="left">spm075.fits</td>
<td class="right">2013-02-17</td>
<td class="right">06:08:08</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:54.400</td>
<td class="right">-05:24:24.00</td>
<td class="right">1.65</td>
<td class="left">S 15 pix</td>
</tr>

<tr>
<td class="left">spm079.fits</td>
<td class="right">2013-02-17</td>
<td class="right">06:27:31</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:54.800</td>
<td class="right">-05:24:22.00</td>
<td class="right">1.80</td>
<td class="left">S 19 pix</td>
</tr>

<tr>
<td class="left">spm083.fits</td>
<td class="right">2013-02-17</td>
<td class="right">06:46:47</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:55.100</td>
<td class="right">-05:24:18.00</td>
<td class="right">1.98</td>
<td class="left">S 22 pix</td>
</tr>

<tr>
<td class="left">spm135.fits</td>
<td class="right">2013-02-18</td>
<td class="right">03:45:31</td>
<td class="left">SII 100A</td>
<td class="right">4</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:59.100</td>
<td class="right">-05:23:54.00</td>
<td class="right">1.25</td>
<td class="left">S 25 pix</td>
</tr>

<tr>
<td class="left">spm087.fits</td>
<td class="right">2013-02-17</td>
<td class="right">07:05:41</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:55.400</td>
<td class="right">-05:24:12.00</td>
<td class="right">2.23</td>
<td class="left">S 26 pix</td>
</tr>

<tr>
<td class="left">spm091.fits</td>
<td class="right">2013-02-17</td>
<td class="right">07:25:12</td>
<td class="left">SII 100A</td>
<td class="right">1</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:56.500</td>
<td class="right">-05:23:47.00</td>
<td class="right">2.58</td>
<td class="left">S 29 pix</td>
</tr>

<tr>
<td class="left">spm120.fits</td>
<td class="right">2013-02-18</td>
<td class="right">02:36:39</td>
<td class="left">SII 100A</td>
<td class="right">4</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:57.100</td>
<td class="right">-05:23:56.00</td>
<td class="right">1.27</td>
<td class="left">S 30 pix</td>
</tr>

<tr>
<td class="left">spm124.fits</td>
<td class="right">2013-02-18</td>
<td class="right">02:55:43</td>
<td class="left">SII 100A</td>
<td class="right">4</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:57.900</td>
<td class="right">-05:23:58.00</td>
<td class="right">1.25</td>
<td class="left">S 31 pix</td>
</tr>

<tr>
<td class="left">spm129.fits</td>
<td class="right">2013-02-18</td>
<td class="right">03:20:19</td>
<td class="left">SII 100A</td>
<td class="right">4</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:58.300</td>
<td class="right">-05:23:58.00</td>
<td class="right">1.24</td>
<td class="left">S 34 pix</td>
</tr>

<tr>
<td class="left">spm139.fits</td>
<td class="right">2013-02-18</td>
<td class="right">04:15:47</td>
<td class="left">SII 100A</td>
<td class="right">4</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:59.700</td>
<td class="right">-05:23:57.00</td>
<td class="right">1.28</td>
<td class="left">S 41 pix</td>
</tr>

<tr>
<td class="left">spm143.fits</td>
<td class="right">2013-02-18</td>
<td class="right">04:35:05</td>
<td class="left">SII 100A</td>
<td class="right">4</td>
<td class="right">100000</td>
<td class="left">70 micron</td>
<td class="right">00003</td>
<td class="right">00002</td>
<td class="right">05:35:59.800</td>
<td class="right">-05:23:58.00</td>
<td class="right">1.31</td>
<td class="left">S 46 pix</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Data from Teresa's <a href="../../Dropbox/SPMFEB13/spm-feb-2013.html#ID-806E4A1D-9ED5-4A4F-81AB-FE37F2412842">table</a></h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>I have removed the first 3 rows that seemed to not belong
</li>
<li>Then I reverse-sorted on the DEC column
<ul class="org-ul">
<li>Which only affected <code>spm135</code>
</li>
</ul>
</li>
</ul>

<table id="orion-s-table" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">#slit</th>
<th scope="col" class="right">RA(2000)</th>
<th scope="col" class="left">RA(HMS)</th>
<th scope="col" class="right">DEC(2000)</th>
<th scope="col" class="right">RA wrt #2</th>
<th scope="col" class="right">RA (arcsec)</th>
<th scope="col" class="right">DEC wrt #2</th>
<th scope="col" class="right">Dec spacing</th>
<th scope="col" class="right">Use?</th>
<th scope="col" class="right">scale x</th>
<th scope="col" class="right">scale y</th>
<th scope="col" class="right">helio corr</th>
<th scope="col" class="right">Res</th>
<th scope="col" class="right">Bright</th>
<th scope="col" class="right">Scale</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">spm046</td>
<td class="right">83.809009</td>
<td class="left">5@ 35' 14.16"</td>
<td class="right">-5.396029</td>
<td class="right">1.72583999999802</td>
<td class="right">25.77</td>
<td class="right">4.22</td>
<td class="right">#ERROR</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-23.95</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm050</td>
<td class="right">83.809215</td>
<td class="left">5@ 35' 14.21"</td>
<td class="right">-5.3965352</td>
<td class="right">1.67640000000006</td>
<td class="right">25.03</td>
<td class="right">2.39</td>
<td class="right">1.83</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.524</td>
<td class="right">-23.98</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm054</td>
<td class="right">83.809513</td>
<td class="left">5@ 35' 14.28"</td>
<td class="right">-5.3967995</td>
<td class="right">1.60487999999987</td>
<td class="right">23.97</td>
<td class="right">1.44</td>
<td class="right">0.95</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.524</td>
<td class="right">-24.03</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm059</td>
<td class="right">83.80941</td>
<td class="left">5@ 35' 14.26"</td>
<td class="right">-5.3973552</td>
<td class="right">1.62959999999885</td>
<td class="right">24.34</td>
<td class="right">-0.56</td>
<td class="right">2.</td>
<td class="right">1</td>
<td class="right">0.35</td>
<td class="right">0.524</td>
<td class="right">-24.07</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm063</td>
<td class="right">83.80951</td>
<td class="left">5@ 35' 14.28"</td>
<td class="right">-5.397564</td>
<td class="right">1.60559999999805</td>
<td class="right">23.98</td>
<td class="right">-1.31</td>
<td class="right">0.75</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-24.1</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm067</td>
<td class="right">83.809978</td>
<td class="left">5@ 35' 14.39"</td>
<td class="right">-5.3979335</td>
<td class="right">1.49327999999855</td>
<td class="right">22.30</td>
<td class="right">-2.64</td>
<td class="right">1.33</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-24.14</td>
<td class="right">1</td>
<td class="right">975</td>
<td class="right">0.99</td>
</tr>

<tr>
<td class="left">spm071</td>
<td class="right">83.810021</td>
<td class="left">5@ 35' 14.41"</td>
<td class="right">-5.39834425</td>
<td class="right">1.48295999999732</td>
<td class="right">22.15</td>
<td class="right">-4.12</td>
<td class="right">1.48</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-24.17</td>
<td class="right">1</td>
<td class="right">975</td>
<td class="right">0.99</td>
</tr>

<tr>
<td class="left">spm075</td>
<td class="right">83.810228</td>
<td class="left">5@ 35' 14.45"</td>
<td class="right">-5.39874525</td>
<td class="right">1.43327999999997</td>
<td class="right">21.40</td>
<td class="right">-5.56</td>
<td class="right">1.44</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-24.2</td>
<td class="right">1</td>
<td class="right">970</td>
<td class="right">0.99</td>
</tr>

<tr>
<td class="left">spm079</td>
<td class="right">83.810262</td>
<td class="left">5@ 35' 14.46"</td>
<td class="right">-5.3990587</td>
<td class="right">1.42512000000011</td>
<td class="right">21.28</td>
<td class="right">-6.69</td>
<td class="right">1.13</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-24.23</td>
<td class="right">1</td>
<td class="right">960</td>
<td class="right">0.98</td>
</tr>

<tr>
<td class="left">spm083</td>
<td class="right">83.810634</td>
<td class="left">5@ 35' 14.55"</td>
<td class="right">-5.3994161</td>
<td class="right">1.33584000000042</td>
<td class="right">19.95</td>
<td class="right">-7.98</td>
<td class="right">1.29</td>
<td class="right">1</td>
<td class="right">0.351</td>
<td class="right">0.525</td>
<td class="right">-24.26</td>
<td class="right">1</td>
<td class="right">940</td>
<td class="right">0.96</td>
</tr>

<tr>
<td class="left">spm135</td>
<td class="right">83.809203</td>
<td class="left">5@ 35' 14.21"</td>
<td class="right">-5.3997455</td>
<td class="right">1.67927999999961</td>
<td class="right">25.08</td>
<td class="right">-9.16</td>
<td class="right">1.18</td>
<td class="right">1</td>
<td class="right">0.35</td>
<td class="right">0.525</td>
<td class="right">-24.15</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm087</td>
<td class="right">83.8106</td>
<td class="left">5@ 35' 14.54"</td>
<td class="right">-5.3997833</td>
<td class="right">1.34400000000028</td>
<td class="right">20.07</td>
<td class="right">-9.30</td>
<td class="right">0.14</td>
<td class="right">0</td>
<td class="right">0.35</td>
<td class="right">0.526</td>
<td class="right">-24.28</td>
<td class="right">2</td>
<td class="right">900</td>
<td class="right">0.92</td>
</tr>

<tr>
<td class="left">spm091</td>
<td class="right">83.810557</td>
<td class="left">5@ 35' 14.53"</td>
<td class="right">-5.4000922</td>
<td class="right">1.3543199999981</td>
<td class="right">20.22</td>
<td class="right">-10.41</td>
<td class="right">1.11</td>
<td class="right">0</td>
<td class="right">0.349</td>
<td class="right">0.526</td>
<td class="right">-24.3</td>
<td class="right">0</td>
<td class="right">880</td>
<td class="right">0.90</td>
</tr>

<tr>
<td class="left">spm120</td>
<td class="right">83.808964</td>
<td class="left">5@ 35' 14.15"</td>
<td class="right">-5.4001608</td>
<td class="right">1.73663999999803</td>
<td class="right">25.93</td>
<td class="right">-10.66</td>
<td class="right">0.25</td>
<td class="right">1</td>
<td class="right">0.349</td>
<td class="right">0.525</td>
<td class="right">-24.02</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm124</td>
<td class="right">83.80912</td>
<td class="left">5@ 35' 14.19"</td>
<td class="right">-5.4003858</td>
<td class="right">1.69920000000047</td>
<td class="right">25.37</td>
<td class="right">-11.47</td>
<td class="right">0.81</td>
<td class="right">0</td>
<td class="right">0.35</td>
<td class="right">0.525</td>
<td class="right">-24.06</td>
<td class="right">0</td>
<td class="right">975</td>
<td class="right">0.99</td>
</tr>

<tr>
<td class="left">spm129</td>
<td class="right">83.809115</td>
<td class="left">5@ 35' 14.19"</td>
<td class="right">-5.4006513</td>
<td class="right">1.70039999999744</td>
<td class="right">25.39</td>
<td class="right">-12.42</td>
<td class="right">0.95</td>
<td class="right">1</td>
<td class="right">0.35</td>
<td class="right">0.525</td>
<td class="right">-24.1</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm139</td>
<td class="right">83.809334</td>
<td class="left">5@ 35' 14.24"</td>
<td class="right">-5.4011967</td>
<td class="right">1.64783999999713</td>
<td class="right">24.61</td>
<td class="right">-14.39</td>
<td class="right">1.97</td>
<td class="right">1</td>
<td class="right">0.35</td>
<td class="right">0.525</td>
<td class="right">-24.2</td>
<td class="right">1</td>
<td class="right">980</td>
<td class="right">1</td>
</tr>

<tr>
<td class="left">spm143</td>
<td class="right">83.809792</td>
<td class="left">5@ 35' 14.35"</td>
<td class="right">-5.401718</td>
<td class="right">1.53791999999839</td>
<td class="right">22.97</td>
<td class="right">-16.26</td>
<td class="right">1.87</td>
<td class="right">1</td>
<td class="right">0.35</td>
<td class="right">0.526</td>
<td class="right">-24.24</td>
<td class="right">1</td>
<td class="right">975</td>
<td class="right">0.99</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="left">0@ 0' 0"</td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1.37</td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="right">-24.14 +/- 0.02</td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="right">0</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>The <code>Res</code> column is a subjective assessment of the angular resolution:
<ul class="org-ul">
<li><code>1</code> : Reasonably good resolution, FWHM ~4 pix = 2.1 arcsec
<ul class="org-ul">
<li>In many cases, the seeing is better than this but the focus is not perfect
</li>
</ul>
</li>
<li><code>2</code> : best resolution, FWHM ~ 3 pixels = 1.6 arcsec
</li>
<li><code>0</code> : poor resolution,  FWHM ~ 5 pixels = 2.6 arcsec
</li>
</ul>
</li>
<li>The <code>Bright</code> column is a measure of the average brightness in a smooth part of the nebula
<ul class="org-ul">
<li>This starts a slight decline from air mass &gt; 1.4
</li>
<li>Steep decline after air mass &gt; 2
</li>
</ul>
</li>
<li>The <code>Scale</code> column is just a normalized version of <code>Bright</code>
<ul class="org-ul">
<li>It is what we should divide the spectra by to give them all the same flux calibration
<ul class="org-ul">
<li>Assuming that transparency is same at 6716 as at 5007, which is probably not quite true
</li>
<li>We could take a non-linear power of <code>Bright</code> maybe
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><code>[2/2]</code> Decision time</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li><code>[X]</code> Best to drop <code>spm087</code> and <code>spm092</code> positions
<ul class="org-ul">
<li>Air mass is too high so blurred and &lt; 90% transparency
</li>
<li>Positions are close to <code>spm135</code> and <code>spm120</code> respectively so no great loss
</li>
</ul>
</li>
<li><code>[X]</code> Not clear whether or not it is best to keep <code>spm124</code>
<ul class="org-ul">
<li>It is a bit blurred
</li>
<li>Transparency is fine
</li>
<li>If we removed it there would be a 1.76" gap, compared with an average of 1.37
<ul class="org-ul">
<li>The largest gap is 2.0 between <code>054</code> and <code>059</code>
</li>
</ul>
</li>
<li><code>[X]</code> There is a bit of a change in positions of things, but we will ditch it
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Inspect the WCS header info in the image-slit files</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">for</span> row <span style="color: #b9d3ee;">in</span> table:
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">fn</span> = row[0]
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #b9d3ee;">if</span> fn:
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn + <span style="color: #eee8aa; font-style: italic;">"_ardec.fits"</span>)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #b9d3ee;">print</span> [hdu.header[k] <span style="color: #b9d3ee;">for</span> k <span style="color: #b9d3ee;">in</span> <span style="color: #eee8aa; font-style: italic;">"CRPIX1"</span>, <span style="color: #eee8aa; font-style: italic;">"CRVAL1"</span>, <span style="color: #eee8aa; font-style: italic;">"CD1_1"</span>, <span style="color: #eee8aa; font-style: italic;">"CRPIX2"</span>, <span style="color: #eee8aa; font-style: italic;">"CRVAL2"</span>, <span style="color: #eee8aa; font-style: italic;">"CD2_2"</span>]
</pre>
</div>

<p>
View all the image-slit files in ds9
</p>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
<span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> *_ardec.fits; <span style="color: #b9d3ee;">do</span>
    xpaset -p ds9 frame new
    xpaset -p ds9 fits $<span style="color: #dfaf8f;">f</span>
<span style="color: #b9d3ee;">done</span>
xpaset -p ds9 match frame wcs
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Removing the ghost line</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>There is a ghost [O III] line, that is shifted to the blue by a few hundred km/s
</li>
<li>It would be good to remove this
</li>
<li>Separation in pixels is 165 - 32 = 133
</li>
<li>Intensity ratio is 124.236/10959 = 0.011336
</li>
<li>Turns out I had to tweak those numbers
</li>
<li>Only remove from lower part of image to avoid wrapping problems
</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy.io.fits <span style="color: #b9d3ee;">as</span> fits
<span style="color: #dfaf8f;">specids</span> = [<span style="color: #eee8aa; font-style: italic;">"047"</span>, <span style="color: #eee8aa; font-style: italic;">"051"</span>, <span style="color: #eee8aa; font-style: italic;">"055"</span>, <span style="color: #eee8aa; font-style: italic;">"060"</span>, <span style="color: #eee8aa; font-style: italic;">"064"</span>, <span style="color: #eee8aa; font-style: italic;">"068"</span>, <span style="color: #eee8aa; font-style: italic;">"072"</span>, <span style="color: #eee8aa; font-style: italic;">"076"</span>, <span style="color: #eee8aa; font-style: italic;">"080"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      <span style="color: #eee8aa; font-style: italic;">"084"</span>, <span style="color: #eee8aa; font-style: italic;">"136"</span>, <span style="color: #eee8aa; font-style: italic;">"088"</span>, <span style="color: #eee8aa; font-style: italic;">"092"</span>, <span style="color: #eee8aa; font-style: italic;">"121"</span>, <span style="color: #eee8aa; font-style: italic;">"125"</span>, <span style="color: #eee8aa; font-style: italic;">"130"</span>, <span style="color: #eee8aa; font-style: italic;">"140"</span>, <span style="color: #eee8aa; font-style: italic;">"144"</span>]
<span style="color: #dfaf8f;">ISHIFT</span> = 133
<span style="color: #dfaf8f;">FACTOR</span> = 0.01
<span style="color: #b9d3ee;">for</span> specid <span style="color: #b9d3ee;">in</span> specids:
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">ghostdata</span> = FACTOR*np.roll(hdu.data, -ISHIFT, axis=0)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">hdu.data</span>[0:100, :] -= ghostdata[0:100, :]
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu.writeto(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-dg.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<p>
Look at the results
</p>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 frame delete all
<span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> spec*-oiii-dg.fits; <span style="color: #b9d3ee;">do</span>
    xpaset -p ds9 frame new
    xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/$<span style="color: #dfaf8f;">f</span>
    xpaset -p ds9 scale limits 0 100
    xpaset -p ds9 cmap invert yes
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<ul class="org-ul">
<li>There is still a faint residual
<ul class="org-ul">
<li>mainly due to the inadequacy of a strictly integer shift
</li>
<li>but this varies from slit to slit
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Removing the continuum and adding WCS info</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>Now that we have laregly eliminated the ghost, we can use the bottom and top borders to fit the continuum.
<ul class="org-ul">
<li>Assume it is constant
</li>
</ul>
</li>
<li>Save the continuum as well
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy.io.fits <span style="color: #b9d3ee;">as</span> fits
<span style="color: #dfaf8f;">specids</span> = [<span style="color: #eee8aa; font-style: italic;">"047"</span>, <span style="color: #eee8aa; font-style: italic;">"051"</span>, <span style="color: #eee8aa; font-style: italic;">"055"</span>, <span style="color: #eee8aa; font-style: italic;">"060"</span>, <span style="color: #eee8aa; font-style: italic;">"064"</span>, <span style="color: #eee8aa; font-style: italic;">"068"</span>, <span style="color: #eee8aa; font-style: italic;">"072"</span>, <span style="color: #eee8aa; font-style: italic;">"076"</span>, <span style="color: #eee8aa; font-style: italic;">"080"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      <span style="color: #eee8aa; font-style: italic;">"084"</span>, <span style="color: #eee8aa; font-style: italic;">"136"</span>, <span style="color: #eee8aa; font-style: italic;">"088"</span>, <span style="color: #eee8aa; font-style: italic;">"092"</span>, <span style="color: #eee8aa; font-style: italic;">"121"</span>, <span style="color: #eee8aa; font-style: italic;">"125"</span>, <span style="color: #eee8aa; font-style: italic;">"130"</span>, <span style="color: #eee8aa; font-style: italic;">"140"</span>, <span style="color: #eee8aa; font-style: italic;">"144"</span>]
<span style="color: #b9d3ee;">for</span> specid <span style="color: #b9d3ee;">in</span> specids:
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-dg.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">low</span> = hdu.data[:15, :].mean(axis=0)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">high</span> = hdu.data[-15:, :].mean(axis=0)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">average</span> = 0.5*(low + high)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">continuum</span> = average[<span style="color: #cFfBcF;">None</span>, :] * np.ones_like(hdu.data)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">hdu.data</span> -= continuum
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu.writeto(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-nc.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid), clobber=<span style="color: #cFfBcF;">True</span>)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">hdu.data</span> = continuum
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu.writeto(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-cc.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
xpaset -p ds9 frame delete all
<span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> spec*-oiii-nc.fits; <span style="color: #b9d3ee;">do</span>
    xpaset -p ds9 frame new
    xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/$<span style="color: #dfaf8f;">f</span>
    xpaset -p ds9 scale limits -5 50
    xpaset -p ds9 cmap invert yes
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
xpaset -p ds9 frame delete all
xpaset -p ds9 frame new
xpaset -p ds9 fits spm063_ardec.fits
xpaset -p ds9 pan to 83.807 -5.4 wcs
xpaset -p ds9 frame new
xpaset -p ds9 fits spm067_ardec.fits
xpaset -p ds9 pan to 83.807 -5.4 wcs
xpaset -p ds9 frame new
xpaset -p ds9 fits spec064-oiii-dg.fits
xpaset -p ds9 pan to 83.807 5007.5 wcs
xpaset -p ds9 frame new
xpaset -p ds9 fits spec068-oiii-dg.fits
xpaset -p ds9 pan to 83.807 5007.5 wcs
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Generating a rough first datacube with WCS info</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li>Miss out slit 092 since it is fainter than the others (high air mass) and is very close to 121
</li>
<li>It turns out that Tere has already aligned the slits in RA
<ul class="org-ul">
<li>I just need to specify
<ul class="org-ul">
<li>the plate scale (<code>CDELT1 = 0.525/3600 = 1.45833333333e-4</code>),
<ul class="org-ul">
<li><code>[X]</code> <b>FIXED</b> This seems wrong <span class="timestamp-wrapper"><span class="timestamp">[2013-10-21 Mon]</span></span>
<ul class="org-ul">
<li>must be slightly larger since we don't match up in RA with HST map
</li>
</ul>
</li>
<li>try 0.525 instead of 0.35
</li>
</ul>
</li>
<li>the RA of 159-350 (<code>CRVAL1 = 83.8164166667</code>),
</li>
<li>and its pixel (<code>CRPIX1 = 289</code>)
</li>
</ul>
</li>
<li><i>Details of calculations for the RA WCS info</i>: 
<ul class="org-ul">
<li>Coords of th1C <code>[RA2000, Dec2000] = [05@ 35' 16.463,  -05@ 23' 23.18] = [83.8185958334, -5.38977222222]</code>
</li>
<li>Relative position of reference star (JW499, 159-350) in arcsec: <code>(-7.5, 26.6)</code> with th1C being north and to the east
<ul class="org-ul">
<li>That is from  <a href="../../Dropbox/Org/orion.html#ID-AAF652F6-09D8-4005-A031-BA524882D9EB">orion.org</a>
</li>
<li>Therefore <code>[RA2000, Dec2000] = [83.8185958334, -5.38977222222] + [-7.5, -26.6]/3600 = [83.8165125001, -5.39716111111]</code>
</li>
<li>Check by converting back to HMS: <code>[5@ 35' 15.963", -5@ 23' 49.78"]</code>.
<ul class="org-ul">
<li>Hmm, not quite accurate enough. 
</li>
</ul>
</li>
<li>O'Dell &amp; Wong (1996) have <code>[5@ 35' 15.94", -5@ 23' 50.04"] = [83.8164166667, -5.39723333333]</code> and we will go with that. 
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>[X]</code> It would be better to put the reference pixel on 159-350, otherwise the fact that the interslit separation is not constant gives us a needless error in the zero point of the declination:
<ul class="org-ul">
<li><code>CRPIX2 = 12</code>
</li>
<li><code>CRVAL2 = -5.39723333333</code> 
</li>
<li><b>OLD VERSION</b> In declinations, we use the average separations calculated above
<ul class="org-ul">
<li><code>CDELT2 = 1.37/3600 = 3.80555555556e-4</code>
</li>
<li><code>CRPIX2 = 1</code>
</li>
<li><code>CRVAL2 = -5.39723333333 - 16.26/3600 = -5.40175</code>
</li>
</ul>
</li>
</ul>
</li>
<li>In wavelength, we can switch to a heliocentric velocity scale.
<ul class="org-ul">
<li>u = c (&lambda; - &lambda;<sub>0</sub>)/&lambda;<sub>0</sub> + HC
<ul class="org-ul">
<li>&lambda;<sub>0</sub> = 5006.85
</li>
<li>Average HC = -24
</li>
</ul>
</li>
<li><code>CDELT3 = 2.99792458e10 0.033379 / 5006.85 1.0e5 = 2.00 km/s</code>
</li>
<li><code>CRVAL3 = (2.99792458e10 (5002 - 5006.85) / 5006.85 1.0e5) - 24 = -314.40 km/s</code>
</li>
<li><code>CRPIX3 = 1</code>
</li>
</ul>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy.io.fits <span style="color: #b9d3ee;">as</span> fits
<span style="color: #dfaf8f;">specids</span> = [<span style="color: #eee8aa; font-style: italic;">"047"</span>, <span style="color: #eee8aa; font-style: italic;">"051"</span>, <span style="color: #eee8aa; font-style: italic;">"055"</span>, <span style="color: #eee8aa; font-style: italic;">"060"</span>, <span style="color: #eee8aa; font-style: italic;">"064"</span>, <span style="color: #eee8aa; font-style: italic;">"068"</span>, <span style="color: #eee8aa; font-style: italic;">"072"</span>, <span style="color: #eee8aa; font-style: italic;">"076"</span>, <span style="color: #eee8aa; font-style: italic;">"080"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      <span style="color: #eee8aa; font-style: italic;">"084"</span>, <span style="color: #eee8aa; font-style: italic;">"136"</span>, <span style="color: #eee8aa; font-style: italic;">"121"</span>, <span style="color: #eee8aa; font-style: italic;">"130"</span>, <span style="color: #eee8aa; font-style: italic;">"140"</span>, <span style="color: #eee8aa; font-style: italic;">"144"</span>]
<span style="color: #dfaf8f;">correct</span> = {<span style="color: #eee8aa; font-style: italic;">"088"</span>: 0.9, <span style="color: #eee8aa; font-style: italic;">"084"</span>: 0.9}
<span style="color: #dfaf8f;">binv</span> = 2<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      <span style="color: #5F7F5F; font-style: italic;"># </span><span style="color: #8b8b83; font-style: italic;">Rebin to 2 pixels = 4 km/s</span>
<span style="color: #dfaf8f;">nx</span>, <span style="color: #dfaf8f;">ny</span>, <span style="color: #dfaf8f;">nv</span> = 625, <span style="color: #DCDCCC; font-weight: bold;">len</span>(specids), 300/binv
<span style="color: #dfaf8f;">cube</span> = np.empty((nv, ny, nx))
<span style="color: #dfaf8f;">cont</span> = np.empty((ny, nx))
<span style="color: #b9d3ee;">for</span> j, specid <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">enumerate</span>(specids):
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-nc.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))
<span style="color: #7f7f7f; background-color: #484848;"> </span>   chdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-cc.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">cont</span>[j, :] = chdu.data.mean(axis=0)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">cube</span>[:, j, :] = hdu.data.reshape((nv, binv, nx)).<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=1)
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #b9d3ee;">if</span> specid <span style="color: #b9d3ee;">in</span> correct:
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">cube</span>[:, j, :] /= correct[specid]
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">cont</span>[j, :]  /= correct[specid]
<span style="color: #dfaf8f;">hdr</span> = fits.Header()
hdr.update(CD1_1=1.45833333333e-4, CRVAL1=83.8164166667, CRPIX1=289.0, CTYPE1=<span style="color: #eee8aa; font-style: italic;">"RA---TAN"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      CD2_2=3.80555555556e-4, CRPIX2=12.0, CRVAL2=-5.39723333333, CTYPE2=<span style="color: #eee8aa; font-style: italic;">"DEC--TAN"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      CD3_3=2.0*binv, CRPIX3=1.0, CRVAL3=-314.4, CTYPE3=<span style="color: #eee8aa; font-style: italic;">"LINEAR"</span>)
fits.PrimaryHDU(cube[:, ::-1, :], hdr).writeto(<span style="color: #eee8aa; font-style: italic;">"rough-cube.fits"</span>, clobber=<span style="color: #cFfBcF;">True</span>)
fits.PrimaryHDU(cube[:, ::-1, :].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=0), hdr).writeto(<span style="color: #eee8aa; font-style: italic;">"rough-map.fits"</span>, clobber=<span style="color: #cFfBcF;">True</span>)
fits.PrimaryHDU(cont[::-1, :], hdr).writeto(<span style="color: #eee8aa; font-style: italic;">"cont-map.fits"</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<ul class="org-ul">
<li>I have fixed the worst issues due to overall brightness changes (slits 088 and 084)
</li>
<li>The remaining issues are due to wavelength calibration variations: particularly slit 130
</li>
</ul>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">Load the cube in ds9</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
xpaset -p ds9 frame new
xpaset -p ds9 fits rough-cube.fits
<span style="color: #5F7F5F; font-style: italic;">#</span><span style="color: #8b8b83; font-style: italic;">xpaset -p ds9 zoom to 1.0 3.91428571429</span>
xpaset -p ds9 scale minmax
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Load the velocity-integrated map in ds9</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
xpaset -p ds9 frame new
xpaset -p ds9 fits rough-map.fits
<span style="color: #5F7F5F; font-style: italic;"># </span><span style="color: #8b8b83; font-style: italic;">xpaset -p ds9 zoom to 1.0 3.91428571429</span>
xpaset -p ds9 scale minmax
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
xpaset -p ds9 frame new
xpaset -p ds9 fits cont-map.fits
<span style="color: #5F7F5F; font-style: italic;"># </span><span style="color: #8b8b83; font-style: italic;">xpaset -p ds9 zoom to 1.0 3.91428571429</span>
xpaset -p ds9 scale limits 0 26
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">Load the DOH datacube for comparison</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li>First make a copy of the DOH cube, with WCS info in the header, as per the <a href="file:///Users/will/Work/BobKPNO/2004/README">README</a>
<ul class="org-ul">
<li>[187, 314] is th1c, which is 5:35:16.44 -5:23:22.96
<ul class="org-ul">
<li>15 deg(5@ 35' 16.44) = 83.8185 deg
</li>
<li>deg(-5@ 23' 22.96) = -5.38971111111 deg
</li>
<li>Plate scale = 0.534 arcsec = 1.48333333333e-4 deg
</li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> astropy.io.fits <span style="color: #b9d3ee;">as</span> fits
hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">"/Users/will/Work/BobKPNO/2004/vcube.oiii.fits"</span>)
hdu.header.update(CD1_1=-1.48333333333e-4, CRVAL1=83.8185, CRPIX1=187.0, CTYPE1=<span style="color: #eee8aa; font-style: italic;">"RA---TAN"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>     CD2_2=1.48333333333e-4, CRPIX2=314.0, CRVAL2=-5.38971111111, CTYPE2=<span style="color: #eee8aa; font-style: italic;">"DEC--TAN"</span>)
hdu.writeto(<span style="color: #eee8aa; font-style: italic;">"DOH-oiii-cube.fits"</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 frame new
xpaset -p ds9 fits DOH-oiii-cube.fits
xpaset -p ds9 scale minmax
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-4" class="outline-3">
<h3 id="sec-7-4">Compare with HST image to check we have the plate scale right</h3>
<div class="outline-text-3" id="text-7-4">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 frame new
xpaset -p ds9 fits /Users/will/Dropbox/JorgeBowshocks/mosaicf656-fixw-align.fits
xpaset -p ds9 scale minmax
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7-5" class="outline-3">
<h3 id="sec-7-5">Now make a rotated cube, equivalent to the DOH vstack cubes</h3>
<div class="outline-text-3" id="text-7-5">
<ul class="org-ul">
<li>This has following axes:
<ol class="org-ol">
<li>NAXIS1 = RA, nx
</li>
<li>NAXIS2 = Heliocentric velocity, nv
</li>
<li>NAXIS3 = Declination, ny
</li>
</ol>
</li>
<li>But python has the order reversed: [ny, nv, nx]
</li>
<li>Individual spectra have
<ul class="org-ul">
<li>NAXIS1 = lambda
</li>
<li>NAXIS2 = RA
</li>
</ul>
</li>
<li>So we need to transpose each data array
</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy.io.fits <span style="color: #b9d3ee;">as</span> fits
<span style="color: #dfaf8f;">specids</span> = [<span style="color: #eee8aa; font-style: italic;">"047"</span>, <span style="color: #eee8aa; font-style: italic;">"051"</span>, <span style="color: #eee8aa; font-style: italic;">"055"</span>, <span style="color: #eee8aa; font-style: italic;">"060"</span>, <span style="color: #eee8aa; font-style: italic;">"064"</span>, <span style="color: #eee8aa; font-style: italic;">"068"</span>, <span style="color: #eee8aa; font-style: italic;">"072"</span>, <span style="color: #eee8aa; font-style: italic;">"076"</span>, <span style="color: #eee8aa; font-style: italic;">"080"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      <span style="color: #eee8aa; font-style: italic;">"084"</span>, <span style="color: #eee8aa; font-style: italic;">"136"</span>, <span style="color: #eee8aa; font-style: italic;">"121"</span>, <span style="color: #eee8aa; font-style: italic;">"130"</span>, <span style="color: #eee8aa; font-style: italic;">"140"</span>, <span style="color: #eee8aa; font-style: italic;">"144"</span>]
<span style="color: #dfaf8f;">correct</span> = {<span style="color: #eee8aa; font-style: italic;">"088"</span>: 0.9, <span style="color: #eee8aa; font-style: italic;">"084"</span>: 0.9}
<span style="color: #dfaf8f;">nx</span>, <span style="color: #dfaf8f;">ny</span>, <span style="color: #dfaf8f;">nv</span> = 625, <span style="color: #DCDCCC; font-weight: bold;">len</span>(specids), 300
<span style="color: #dfaf8f;">cube</span> = np.empty((ny, nv, nx))
<span style="color: #b9d3ee;">for</span> j, specid <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">enumerate</span>(specids):
<span style="color: #7f7f7f; background-color: #484848;"> </span>   hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">"spec{}-oiii-nc.fits"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">cube</span>[j, :, :] = hdu.data
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #b9d3ee;">if</span> specid <span style="color: #b9d3ee;">in</span> correct:
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #dfaf8f;">cube</span>[j, :, :] /= correct[specid]
<span style="color: #dfaf8f;">hdr</span> = fits.Header()
hdr.update(CD1_1=1.45833333333e-4, CRVAL1=83.8164166667, CRPIX1=289.0, CTYPE1=<span style="color: #eee8aa; font-style: italic;">"RA---TAN"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      CD3_3=3.80555555556e-4, CRPIX3=12.0, CRVAL3=-5.39723333333, CTYPE3=<span style="color: #eee8aa; font-style: italic;">"DEC--TAN"</span>,
<span style="color: #7f7f7f; background-color: #484848;"> </span>   <span style="color: #7f7f7f; background-color: #484848;"> </span>      CD2_2=2.0, CRPIX2=1.0, CRVAL2=-314.4, CTYPE2=<span style="color: #eee8aa; font-style: italic;">"LINEAR"</span>)
fits.PrimaryHDU(cube[::-1, :, :], hdr).writeto(<span style="color: #eee8aa; font-style: italic;">"spm-vstack-oiii.fits"</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 cd $<span style="color: #dfaf8f;">PWD</span>
xpaset -p ds9 frame new
xpaset -p ds9 fits spm-vstack-oiii.fits
xpaset -p ds9 scale minmax
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: William Henney</p>
<p class="date">Created: 2013-10-21 Mon 11:25</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.1)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
